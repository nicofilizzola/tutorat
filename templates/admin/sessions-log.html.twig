{% extends 'base.html.twig' %}

{% block title %}Hello AdminController!{% endblock %}

{% block stylesheets %}
	{{ encore_entry_link_tags('app_sessions_log') }}
	{{ encore_entry_link_tags('app') }}
{% endblock %}


{% block body %}
	<div class="smooth--container" data-lg-smooth>
        <div class="container">
            <div class="form--container">
                <div class="form--content">
                    <div class="collapse collapse_2">
                        <form 
                            action="{{ path('app_sessions_log') }}" 
                            method="POST" 
                            id="js-semester">
                            <span>Semestre</span>
                            <select name="semester" class="hoveredItems" onchange="document.querySelector('#js-semester').submit();">
                                {% for semester in semesters %}
                                    {% if semester == currentSemester %}
                                        <option value="{{ semester.id }}" selected="selected">{{ semester }} {{ loop.index0 == 0 ? "(Semestre actuel)" : ""}}</option>
                                    {% else %}
                                        <option value="{{ semester.id }}">{{ semester }} {{ loop.index0 == 0 ? "(Semestre actuel)" : ""}}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </form>
                        <form action="" method="GET" id="js-tutor">
                            <span>Tuteur</span>
                            <select name="tutor" class="hoveredItems" onchange="document.querySelector('#js-tutor').submit();">
                                <option value="">Tous</option>
                                {% for tutor in tutors %}
                                    <option value="{{ tutor.id }}">{{ tutor }}</option>
                                {% endfor %}
                            </select>
                        </form>
                    </div>
                </div>
            </div>

            <div class="logs--container">
                {% if sessions is empty == false %}
                    {% for session in sessions %}
                        <div class="logs--content">
                            <span>Titre du cours : {{ session.title }}</span>
                            <span>Tuteur : {{ session.tutor }}</span>
                            <span>Le {{ session.dateTime | date('d-m-Y') }} à {{ session.dateTime | date('h:i') }}</span>

                            {% if session.timeFormat == 1 %}
                                {% set timeFormatMessage = "30 minutes" %}
                            {% elseif session.timeFormat == 2 %}
                                {% set timeFormatMessage = "45 minutes" %}
                            {% elseif session.timeFormat == 3 %}
                                {% set timeFormatMessage = "1 heure" %}
                            {% endif %}
                            <span>Durée : {{ timeFormatMessage }}</span>

                            {% if session.participants is empty %}
                                <span>Statut : Cours non validé</span>
                                {% if session.students is empty %}
                                    <span>Pas d'étudiants inscrits</span>
                                {% else %}
                                    <span>Étudiants inscrits :</span>
                                    <ul>
                                        {% for student in session.students %}
                                            <li>{{ student }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            {% else %}
                                <span>Cours validé</span>
                                <span>Étudiants inscrits :</span>
                                <ul>            
                                    {% for student in session.students %}
                                        <li>{{ student }} :
                                        {% for participant in session.participants %}
                                            {% if student.id == participant.studentId %}
                                                {{ participant["present"] == true ? "Présent" : "Absent" }}   
                                            {% endif %}
                                        {% endfor %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% else %}
                    <span><b>Pas de sessions</b></span>
                {% endif %}
            </div>
        </div>
    </div>

{% endblock %}