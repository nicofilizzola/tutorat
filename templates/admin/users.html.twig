{% extends 'base.html.twig' %}

{% block title %}Hello AdminController!{% endblock %}

{% block stylesheets %}
    {{ encore_entry_link_tags('app_users') }}
    {{ encore_entry_link_tags('app') }}
{% endblock %}

{% block body %}

    <div class="container" data-lg-smooth>
        <div class="search--container">
            <input type="text">
            <select name="filtre">
                <option>Nom</option>
                <option>Pr√©nom</option>
                <option>R√¥le</option>
                <option>Statut</option>
            </select>
        </div>

        <div class="content--container" data-lg-reveal="fade" data-lg-reveal-stagger="0.1">
            {% if users is empty == false %}
                {% set roleViewLabels = {
                    "ROLE_STUDENT": "√âtudiant",
                    "ROLE_TUTOR": "√âtudiant tuteur",
                    "ROLE_ADMIN": "Administrateur",
                } %}
                {% for user in users %}
                    <div class="userContent--container">
                        <div class="content name">
                            <span>{{ user.firstName | upper }} {{ user.lastName | capitalize }}</span>
                        </div>
                        
                        <div class="content mail">
                            <span>{{ user.email | lower }}</span>
                        </div>
                        
                        <div class="content role">
                            <span>{{ roleViewLabels[user.roles[user.roles | length - 2]] }}</span> {# -1 for length index and -1 for ROLE_USER which always goes last #}
                        </div>
                        
                        <div class="content statut">
                            {% if user.isValid == 1 %}
                                <span>En attente</span>
                            {% elseif user.isValid == 2 %}
                                <span>Valid√©.e</span>
                            {% else %}
                                <span>Refus√©.e</span>
                            {% endif %}
                        </div>
                        
                        <div class="content manage">
                            {% if user.isValid == 1 %}
                                <button onclick="event.preventDefault(); document.querySelector('#js-user-validate-form-{{ user.id }}').submit()" class="hoveredItems validate">
                                    <span>‚úîÔ∏è</span>
                                </button>
                                <button onclick="event.preventDefault(); document.querySelector('#js-user-cancel-form-{{ user.id }}').submit()" class="hoveredItems refuse">
                                    <span>‚ùå</span>
                                </button>
                            {% else %}
                                <button disabled class="hoveredItems lineHoverEffectvalidate disabled">
                                    <span>‚úîÔ∏è</span>
                                </button>
                                <button disabled class="hoveredItems lineHoverEffectrefuse disabled">
                                    <span>‚ùå</span>
                                </button>
                            {% endif %}
                            <button onclick="event.preventDefault(); document.querySelector('#js-user-delete-form-{{ user.id }}').submit()" class="hoveredItems refuse">
                                <span>üóëÔ∏è</span>
                            </button>
                        </div>
                    </div>

                    <!-- <div class="card--container">
                        <div class="card" data-id={{user.id}}>
                            <div class="card--content">
                                <div class="name">
                                    <span>{{ user.firstName | upper }}</span>
                                    <span>{{ user.lastName | capitalize }}</span>
                                </div>
                                <span id="mail">{{ user.email | lower }}</span>
                                <span>{{ roleViewLabels[user.roles[user.roles | length - 2]] }}</span> {# -1 for length index and -1 for ROLE_USER which always goes last #}
                            </div>
                            <p>{{ user.isValid }}</p>
                            {# 1 == en attente #}
                            {# 2 == valid√©.e #}
                            {# 3 == refus√©.e #}
                            {% if user.isValid == 1 %}
                                <p>En attente</p>
                                <div class="card--buttons">
                                    <button 
                                        onclick="event.preventDefault(); document.querySelector('#js-user-validate-form-{{ user.id }}').submit()" 
                                        class="hoveredItems validate">
                                        <span>‚úîÔ∏è</span>
                                    </button>
                                    <button 
                                        onclick="event.preventDefault(); document.querySelector('#js-user-cancel-form-{{ user.id }}').submit()" 
                                        class="hoveredItems refuse">
                                        <span>‚ùå</span>
                                    </button>
                                    <button 
                                        onclick="event.preventDefault(); document.querySelector('#js-user-delete-form-{{ user.id }}').submit()" 
                                        class="hoveredItems refuse">
                                        <span>üóëÔ∏è</span>
                                    </button>
                                </div>
                            {% endif %}
                        </div>
                    </div> -->

                    <form 
                        id="js-user-validate-form-{{ user.id }}"
                        display="none" 
                        hidden
                        action="{{ path('app_user_validate', {"id": user.id}) }}" 
                        method="POST">
                        <input type="hidden" name="token" value="{{ csrf_token('validate-user' ~ user.id) }}"/>
                        {# <input type="hidden" name="_method" value="PUT"/> #}
                    </form>
                    <form 
                        id="js-user-cancel-form-{{ user.id }}"
                        display="none" 
                        hidden
                        action="{{ path('app_user_cancel', {"id": user.id}) }}" 
                        method="POST">
                        <input type="hidden" name="token" value="{{ csrf_token('cancel-user' ~ user.id) }}"/>
                        {# <input type="hidden" name="_method" value="PUT"/> #}
                    </form>
                    <form 
                        id="js-user-delete-form-{{ user.id }}"
                        display="none" 
                        hidden
                        action="{{ path('app_user_delete', {"id": user.id}) }}" 
                        method="POST">
                        <input type="hidden" name="token" value="{{ csrf_token('delete-user' ~ user.id) }}"/>
                        {# <input type="hidden" name="_method" value="PUT"/> #}
                    </form>
                {% endfor %}

            {% else %}
                <h2>Pas d'utilisateurs √† valider</h2>
            {% endif %}
        </div>

        {% include "components/_footer.html.twig" %}
    </div>

{% endblock %}
